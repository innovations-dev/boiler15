# Boilerplate Improvement Task List

## Completed Features ‚úÖ

# useApiQuery Refactor Checklist

## 1. Core Hook Modifications

- [ ] Modify useApiQuery to handle raw data instead of wrapped responses

```jsx
export function useApiQuery<T extends z.ZodType>(
  key: readonly unknown[],
  queryFn: () => Promise<z.infer<T>>,
  schema: T,
  options?: Omit<UseQueryOptions<z.infer<T>>, "queryKey" | "queryFn">
) {
  return useQuery<z.infer<T>>({
    queryKey: key,
    queryFn: async () => {
      try {
        const data = await queryFn();
        return schema.parse(data);
      } catch (error) {
        logError(error, `useApiQuery:${key.join(":")}`);
        errorLogger.log(error, ErrorSource.QUERY, {
          context: `useApiQuery:${key.join(":")}`,
        });

        if (error instanceof ApiError) {
          throw createApiResponse(null, {
            message: error.message,
            code: error.code as ApiErrorCode,
            status: error.status,
          });
        }
        if (error instanceof z.ZodError) {
          throw createApiResponse(null, {
            message: "Validation error",
            code: "VALIDATION_ERROR",
            status: 400,
            details: { errors: error.errors },
          });
        }
        throw error;
      }
    },
    meta: {
      onError: (error: unknown) => {
        const message = isQueryError(error)
          ? error.message
          : "An unexpected error occurred";
        toast.error(message);
      },
    },
    ...options,
  });
}
```

- Remove double wrapping of responses
- Simplify error handling flow
- Update type definitions

## 2. Schema Handling

- [ ] Update schema handling pattern
- [ ] Create new utility for handling API response schemas
- [ ] Separate data validation from response wrapping

## 3. Error Handling Updates

- [ ] Consolidate error handling logic

```ts
export const handleApiError = async (
  error: unknown,
  path = "unknown"
): Promise<Response> => {
  await errorLogger.log(error, ErrorSource.API, {
    path,
    requestId: crypto.randomUUID(),
  });

  if (error instanceof ApiError) {
    return Response.json(
      { code: error.code, message: error.message },
      { status: error.status }
    );
  }

  if (error instanceof z.ZodError) {
    return Response.json(
      {
        code: API_ERROR_CODES.BAD_REQUEST,
        message: "Invalid request data",
        errors: error.errors,
      },
      { status: 400 }
    );
  }

  return Response.json(
    {
      code: API_ERROR_CODES.INTERNAL_SERVER_ERROR,
      message: "Internal server error",
    },
    { status: 500 }
  );
};
```

- [ ] Create consistent error transformatio
- [ ] Update error logging pattern
- [ ] Standardize error response format

## 4. Type System Updates

- [ ] Create new type definitions for:
- [ ] Raw query responses
- [ ] Transformed query data
- [ ] Error states
- [ ] Query options

## 5. Implementation Updates

- [ ] Update all existing query implementations:
- [ ] Organizations queries
- [ ] User queries
- [ ] Session queries
- [ ] Auth queries

## 6. Response Handling

- [ ] Create new response transformation utilities:
- [ ] transformQueryResponse utility
- [ ] handleQueryError utility
- [ ] validateQueryData utility

## 7. Documentation Updates

- [ ] Update documentation for:

```ts
/**
 * Custom hook that combines React Query with Zod schema validation and error handling for API requests.
 *
 * @template T - Extends z.ZodType for runtime type validation
 *
 * @param key - React Query cache key array used for query identification and caching
 * @param queryFn - Async function that performs the API request
 * @param schema - Zod schema used to validate the API response
 * @param options - Additional React Query options (excluding queryKey and queryFn)
 *
 * @returns React Query result object containing data, error, and status information
 *
 * @throws {ApiError} When the API request fails
 * @throws {z.ZodError} When response validation fails
 *
 * @example
 * // Example usage with a user profile endpoint
 * const userSchema = z.object({
 *   id: z.string(),
 *   name: z.string(),
 *   email: z.string().email()
 * });
 *
 * function useUserProfile(userId: string) {
 *   return useApiQuery(
 *     ['user', userId],
 *     () => fetch(`/api/users/${userId}`).then(res => res.json()),
 *     userSchema
 *   );
 * }
 *
 * // In your component:
 * const { data, isLoading, error } = useUserProfile('123');
 *
 * @example
 * // Example with custom options
 * const { data } = useApiQuery(
 *   ['posts'],
 *   () => fetch('/api/posts').then(res => res.json()),
 *   postsSchema,
 *   {
 *     staleTime: 5 * 60 * 1000, // 5 minutes
 *     refetchOnWindowFocus: false
 *   }
 * );
 *
 * @features
 * - Automatic error handling and logging
 * - Runtime type validation using Zod
 * - Toast notifications for errors
 * - Integration with custom error logging system
 * - Type-safe API responses
 */
```

- [ ] New implementation patterns
- [ ] Error handling approach
- [ ] Schema validation
- [ ] Type safety

## 8. Testing Updates

- [ ] Create new test patterns for:
- [ ] Raw data handling
- [ ] Error scenarios
- [ ] Schema validation
- [ ] Response transformation

## 9. Migration Guide

- [ ] Create migration documentation for:
- [ ] Updating existing queries
- [ ] Error handling changes
- [ ] Schema updates
- [ ] Type system changes

## 10. Performance Optimization

- [ ] Implement optimizations:
- [ ] Reduce unnecessary transformations
- [ ] Optimize error handling
- [ ] Improve type inference
- [ ] Enhance caching strategy

```text
Code to clean up:
defaultResponse helper function - no longer needed as we're returning raw data
createApiResponseSchema wrapper - no longer needed as we're validating raw data
Remove success/error wrapping from all query functions
Files to clean up:
lib/schemas/api-types.ts:
Remove createApiResponseSchema function
Remove related types that were only used for response wrapping
lib/query/types.ts:
Remove QueryResult type
Clean up any other types related to the old pattern
Any utility functions in other files that were only used for response wrapping
```

### Admin Dashboard

- [x] Comprehensive audit logging system

  - Basic functionality
  - Timestamp handling
  - Pagination
  - Error handling
  - Protected routes

- [x] System health monitoring
  - API response time tracking
  - Database status monitoring
  - Server load metrics
  - Health monitoring UI

### Security

- [x] Authentication & protection
  - Proper authentication checks
  - Protected routes (auth-guard)
  - Error boundaries
  - Admin action logging

## In Progress Features üîÑ

### Dashboard

- [ ] Replace hardcoded values with real data
  - [x] System metrics
  - [ ] Activity feeds
  - [ ] User statistics

## Pending Features ‚è≥

### Admin Dashboard Enhancements

- [ ] User Management

  - [ ] User overview dashboard
  - [ ] Bulk actions
  - [ ] User activity tracking
  - [ ] User permissions management

- [ ] Organization Management

  - [ ] Organization overview
  - [ ] Organization settings
  - [ ] Member management
  - [ ] Billing integration

- [ ] System Management
  - [ ] Backup/restore functionality
  - [ ] System settings
  - [ ] Email template management
  - [ ] Feature flag management

### Regular Dashboard Improvements

- [ ] Organization Features

  - [ ] Organization switcher
  - [ ] Organization-specific metrics
  - [ ] Team member management

- [ ] Personalization

  - [ ] User preferences
  - [ ] Dashboard customization
  - [ ] Theme settings
  - [ ] Notification preferences

- [ ] Interactive Features
  - [ ] Quick action buttons
  - [ ] Notification center
  - [ ] Activity feed filters
  - [ ] Real-time updates

### Route Restructuring

- [ ] Analytics

  - [ ] Separate /analytics route
  - [ ] Detailed metrics view
  - [ ] Custom report builder
  - [ ] Data export functionality

- [ ] Admin Routes
  - [ ] /admin/users - User management
  - [ ] /admin/organizations - Organization management
  - [ ] /admin/system - System settings

### Performance Optimizations

- [ ] Caching

  - [ ] Dashboard metrics caching
  - [ ] API response caching
  - [ ] Static asset optimization

- [ ] Data Management
  - [ ] Efficient data fetching
  - [ ] Pagination improvements
  - [ ] Real-time updates optimization

### Accessibility Improvements

- [ ] Core Accessibility

  - [ ] ARIA labels implementation
  - [ ] Proper heading hierarchy
  - [ ] Keyboard navigation support
  - [ ] Focus management

- [ ] Visual Accessibility

  - [ ] Color contrast improvements
  - [ ] Screen reader descriptions
  - [ ] Responsive text sizing
  - [ ] Animation controls

- [ ] Interactive Elements
  - [ ] Accessible forms
  - [ ] Error messaging
  - [ ] Loading states
  - [ ] Success feedback

## Next Priority Areas

1. Regular Dashboard Improvements

   - Replace remaining hardcoded values
   - Implement organization switcher
   - Add personalization options

2. Admin Features

   - Complete user management features
   - Add organization management
   - Implement backup/restore functionality

3. Accessibility
   - Implement comprehensive accessibility improvements
   - Add proper ARIA labels and keyboard navigation

## Notes

- Priority of tasks may change based on project requirements
- Each feature should include proper documentation
- All new features should maintain existing type safety
- Testing should be implemented for all new features
